#!/usr/bin/env zsh

HOST="`hostname`"
DIR="$HOME/.dotfiles/homebrew/lists/$HOST"
mkdir -p "$DIR"
cd "$DIR"

echo "Updating list files for $HOST.."
brew list > brew.$HOST.list
brew tap > brew-tap.$HOST.list
brew cask list > brew-cask.$HOST.list
mas list > mas.$HOST.list

brew bundle dump --force
mv ./Brewfile Brewfile.$HOST.list

# Atom
apm list --installed --bare > apm.$HOST.list

# Node
npm list -g --depth=0 > npm.$HOST.list

# Ruby
ruby -e 'puts Gem::Specification.all_names' > gem.$HOST.list

# Python
source `dirname $0`/../python/python-versions.zsh
eval "$(pyenv init -)"

pyenv shell $PYTHON_2X_VER
pip list > pip.$HOST.list

pyenv shell $PYTHON_3X_VER
pip3 list > pip3.$HOST.list

pyenv shell --unset

# echo Staging in git..
# git add brew.list
# git add brew-tap.list
# git add brew-cask.list

# echo Diffs..
# git diff brew.list
# git diff brew-tap.list
# git diff brew-cask.list
# git diff Brewfile.list
# git diff mas.list
git status
